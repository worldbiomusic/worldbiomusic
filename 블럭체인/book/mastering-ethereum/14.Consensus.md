# 합의
- 서로의 의견이 일치하는 것

# 블럭체인에서 합의
- 블럭체인이 합의가 필요한 이유는 p2p 네트워크 즉, 중재해줄 중앙화 노드가 없는 분산 시스템 기반이기 때문
- 분산 시스템에서 네트워크를 사용할 때 공유되는 상태(자원)가 일치가 될 수 있어야 네트워크가 정상적으로 작동
- 보통 합의를 위해선 제3자의 개입이나, 일정 수준의 신뢰가 필요한 방법들이 있지만, **블럭체인은 합의를 구현할 때 완벽한 기술로 구현했다기 보다는, 화폐, 인센티브 시스템을 도입해서, 
개인의 이익이 결국엔 네트워크의 정상적인 동작으로 이어지는 생태계를 설계**해서 `신뢰가 불필요한 시스템`으로 생태계를 구성함 (즉, 블럭체인 시스템 내에서 `화폐`, `인센티브`는 필수)

- 결국에는, 분산시스템에서 합의란 탈중앙화를 해결하는데 사용되는 것

# 작업증명
- Pow (Proof-of-Work)
- 비트코인의 블럭체인 시스템에서 처음 등장한/사용한 합의 매커니즘
- 실질적으로 비트코인이 정상적으로 동작할 수 있게 만든 시스템 설계
- 다른 합의 알고리즘보다 효율성이 떨어지지만, 보안성이 뛰어나고, 탈중앙화의 본질에 가까운 알고리즘

## 채굴
- 컴퓨터 자원을 사용해서 디지털 머니를 얻는 것
- 인센티브 시스템
- 개인만의 이득을 취하는것 같지만, 실질적인 효과은 네트워크를 유지시키는데 기여함
- `채굴`은 탈중화 네트워크에서 `합의`라는 **목적**을 위해 사용되는 **수단**

### 이더리움의 PoW
- 이더리움은 2022-01 현재도 PoW 합의 알고리즘으로 사용중 (PoS 전환 계획이 계속 미뤄짐)
- `Ethash`라고 함
- 채굴의 중앙화를 피해기 위해 ASIC 저항성(알고리즘이 주기적으로 변경됨)을 가지는 특징이 있음 (채굴자들이 독립적일 수록 채굴파워가 탈중앙화 되기 때문에)
- 실제로 최근까지 이더리움 네트워크는 ASIC 채굴자들의 위협이 없었음
1. 왜냐하면 이더리움에서 사용하는 ASIC에 저항성을 갖는 Ethash 합의 알고리즘때문에 ASIC 채굴기를 커스텀하려는데 비용이 많이 듦
2. PoW에서 PoS로 전환하려는 이더리움의 계획이 계속 늦춰져서 ASIC채굴자들의 채굴을 막는 효과를 가지게 됨

---

# 지분증명
- PoS(Proof-of-Stake)
- 코인 보유량(특정 컨트랙트에 예치된 양)에 비례해서 의사결정 권한 크기를 가짐, 보상도 코인 보유량에 비해서 받음 (코인을 많이 가지고 있으면 네트워크의 가치 상승을 위해서 계속 옳바른 선택을 하게 유도됨)
- 처벌이 PoW보다 더 강함 (PoW처벌: 전기료 요금, PoS: 실질적인 이더 손실)
- PoW보다 보안은 낮아도(PoW는 실질적인 계산 능력의 우위가 네트워크에서 결정권한이 크기만, PoS는 단순히 가지고 있는 코인의 양이 네트워크에서 결정권한이 크기 때문), 효율적(채굴이 없어 비용이 적음), but 빈익빈 부익부의 성격을 띄어서 탈중앙화의 본질을 조금 해침 (사실 PoW도 채굴파워에 비례해서 얻기 때문에 빈익빈 부익부의 성격을 띔)
- Q. 권한 크기는 코인 보유량에 비례해서 하되, 보상 크기는 모두 다 동등하게 하면 안되나? (이것이 가능하면 더 탈중앙화적이고, 빈익빈 부익부가 없어지고)
- A. 잘못 하면 자신의 예치된 돈이 날아가므로 충분히 옳바른 블럭에 투표할 것이므로 네트워크의 동작은 가능하다, but 공산주의와 비슷하게 볼 수 있음 (보상이 같으므로), 그러면 채굴자들이 더 열심히 일을 하지 않게 되서 네트워크의 성장이 느릴 수는 있다
- A. 돈을 가지고 있는 사람들의 직접적인 유인책(유도)가 약해지므로(보상이 같으므로), 참여율이 저조해져서 보안이 낮아질 수 있는 큰 문제점이 존재 (e.g. 코인 많이 가지고 있는 사람이 직접 참여를 안하고 다른 코인 보유한 많은 사람이 해주겠지~ 라는 유인책이 많이 약해지는 효과가 있음)

### 이더리움의 PoS
- 이더리움이 채굴의 중앙화를 피하기 위해 최종적으로 바꾸려고 하는 합의 알고리즘
- 이더리움의 지분증명 알고리즘은 `Casper`라고 불림 (Capser는 `FFG`(PoW + PoS)와 `CBC`(pure PoS로 나뉘어서 개발중)

---

- 작업증명는 절대적인 계산에 초점(증명)을 둬서 동작하는 생태계
- 지분증명은 처벌에 초점을 둬서 동작하는 생태계

---

PoW의 중앙집중화와 PoS의 중앙집중화의 개념은 살짝 다름
- PoW의 중앙집중화는 절대적인 계산의 모임이 커져야 하고
- PoS는 중앙집중화는 단순히 가지고 있는 돈만 커지면 되 -> PoW보다 더 중앙화가 쉽게 될 수 있는 단점 존재

---

# 합의의 원칙
- 다시 말하면 합의의 **최소한의** 원칙
```
- 누가 어떻게 과거/미래를 변경할지
- 변경에 드는 비용은 어느정도인지
- 변경에 드는 힘은 어떤 방식으로 탈중앙화 되있는지
- 변경에 어떤게 바뀐지 어떻게 누가 알 수 있는지
```

# 완벽한건 없다
- 컴퓨터과학에서 효과적이라는 것은 다른것들과 연관이 없을 수 없는 trade-off 관계
```
블럭체인의 3요소
- 보안성
- 확장성(효율성과 관련)
- 탈중앙성

- 이 3가지는 하나가 변하면 다른 2개에 영향을 많이 줌
- 합의 알고리즘이 이 3요소에 대부분의 영향을 줌
```
- 그러므로 합의 알고리즘도 각 블럭체인의 성격에 맞는것으로 사용되야 적절하다
- 효과적이라는것을 떠나서 다른 모든것들도 시소처럼 어떤것을 얻으려면 다른 무언가를 잃을 수 밖에 없다
- 옳바른것은 없지만, 적절한것은 있다



# 결론
- 블럭체인에서 사용하는 합의 알고리즘은 공유 분산 원장을 전제로 함 (공유 분산 원장은 모든 합의 알고리즘의 공통적인 특징이 아니라 블럭체인의 합의 알고리즘이 사용하는 방식의 일부 (다른 합의 알고리즘은 공유 분산 원장을 사용하지 않을 수도 있음(e.g. zero-knowledgement를 사용하고 데이터 저장이 필요없는 합의라면 공유 분산 원장을 사용할 필요가 없음))))
- 블럭체인의 합의 알고리즘은 컴퓨터 과학을 토대로 하고 밀접한 관련도 있지만, 개념적으로 보면 수학적으로 돌아가는 시스템이 아닌, 생명(사람)의 욕심에 의해 동작하는 알고리즘이므로 예측하기는 힘들어 시간이 지나 얻은 결과가 가장 정확한 결과일 것이다











